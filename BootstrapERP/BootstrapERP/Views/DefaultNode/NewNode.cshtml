@model BootstrapERP.Models.NodeList
@{
    ViewBag.Title = "New Node";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-header">
                <h4 style="display:inline-block"><span class="hapText"> @ViewBag.Title</span> <small> </small></h4>
                <ol class="breadcrumbLine" style="float:right;display:inline-block">
                    <li class="hapText">@Html.ActionLink("Home", "Index", "BlogPosts")</li>
                    <li class="hapText">@ViewBag.Title</li>
                </ol>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="col-sm-12" style="min-height:550px">
            @using (Html.BeginForm("NewNode", "DefaultNode"))
            {
                @Html.ValidationSummary(true)
                @Html.AntiForgeryToken()
            <div class="row">
                <div class="col-lg-3 col-md-3">
                    @*<div class="panel panel-primary">
                <div class="panel-heading">Default Node List</div>
                <div class="panel-body">
                    <div id="tree" style="min-height:340px"></div>
                    <div class="clearfix"></div>
                    <div>
                        <a style="text-decoration:none;" href="@Url.Action("NewNode", "DefaultNode")">
                            <span style="margin-left:0px" class="btn btn-warning glyphicon glyphicon-plus">Add Node</span>
                        </a>
                    </div>
                    <div class="clearfix"></div>
                    <br />
                </div>
            </div>*@

                </div>
                <div class="col-lg-6 col-md-6">
                    <div class="form-group ">
                        <label for="input1" class="labelcss">Parent Node</label>
                        @Html.DropDownList("DefaultNode", null, new { type = "text", @class = "form-control" })
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group ">
                        <label for="input1" class="labelcss">Title</label>
                        @Html.TextBoxFor(model => model.ActivityName, new { style = "width:100%;", @class = "form-control", @required = true })
                        @Html.ValidationMessageFor(model => model.ActivityName, "", new { @class = "text-danger" })

                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group ">
                        <label for="input1" class="labelcss">Type</label><br />
                        @Html.DropDownList("NodeTypes", null, new { type = "text", @class = "form-control" })
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group ">
                        <label for="input1" class="labelcss">Position</label><br />
                        @Html.DropDownList("NodePositions", null, new { type = "text", @class = "form-control" })
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group ">
                        <label for="input1" class="labelcss">Controller Title</label><br />
                        @Html.TextBoxFor(model => model.ControllerTitle, new { style = "width:100%;", @class = "form-control", @required = true })
                        @Html.ValidationMessageFor(model => model.ControllerTitle, "", new { @class = "text-danger" })
                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group">
                        <label for="input1" class="labelcss">Action Title</label><br />
                        @Html.TextBoxFor(model => model.ActionTitle, new { style = "width:100%;", @class = "form-control", @required = true })
                        @Html.ValidationMessageFor(model => model.ActionTitle, "", new { @class = "text-danger" })

                    </div>
                    <div class="clearfix"></div>
                    <div class="form-group ">
                        <button type="submit" name="saveNewNode"  class="btn btn-primary btn-anim"><i class="fa fa-pencil"></i><span class="btn-text">Save</span></button>
                        &nbsp;&nbsp;|&nbsp;&nbsp;@Html.ActionLink("Back to List", "Index", "DefaultNode")
                    </div>
                </div>

                <div class="col-lg-3 col-md-3"></div>
                    
                </div>
                <div class="clearfix"></div>

                }
            </div>


    </div>
</div>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/Gijgo/gijgo.js"></script>
    <script src="~/Scripts/conditional-validation.js"></script>
    <link href="~/http://code.gijgo.com/1.3.0/css/gijgo.css" rel="stylesheet" type="text/css" />


    <script src="/js/jquery.js" type="text/javascript"></script>
    <script src="/js/jquery.contextMenu.js" type="text/javascript"></script>
    

    <script type="text/javascript">

        $(document).ready(function () {
            var Usertree = "";
            var tree = "";
            $.ajax({
                type: 'get',
                dataType: 'json',
                cache: false,
                url: '@Url.Action("GetHierarchy", "DefaultNode")',
                success: function (records, textStatus, jqXHR) {
                    tree = $('#tree').tree({
                        primaryKey: 'Id',
                        dataSource: records,
                        dragAndDrop: true,
                        checkboxes: true,
                        iconsLibrary: 'glyphicons',
                    });
                    Usertree = $('#Usertree').tree({
                        primaryKey: 'Id',
                        dataSource: records,
                        dragAndDrop: false,
                        checkboxes: true,
                        iconsLibrary: 'glyphicons',
                    });
                    
                    //delete node
                    $('#btnDeleteNode').click(function (e) {
                        e.preventDefault();
                        var result = tree.getCheckedNodes();
                        if (result != "") {
                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("DeleteNode", "UserPermission")',
                                data: { values: result.toString() },
                                dataType: "json",
                                success: function (data) {
                                    alert("Deleted successfully ");
                                    window.location.reload();
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    alert('Error - ' + errorThrown);
                                },
                            });
                        }
                        else {
                            alert("Please select Node to delete..!!");
                        }
                    });
                    //Create Role node
                    $('#saveRole').click(function (e) {
                        e.preventDefault();

                        var blogRoleType = $('#BlogRoleType').val();
                        var roleTitleTemp = $('#roleTitle').val();

                        var result = tree.getCheckedNodes();
                        if (result != "") {
                            blogRoleType = blogRoleType + "," + roleTitleTemp + "," + result;
                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("Index", "UserPermission")',
                                //data: { values: result.toString() },
                                data: { values: blogRoleType.toString() },
                                dataType: "json",
                                success: function (data) {
                                    alert("Role Created successfully ");
                                    window.location.reload();
                                },
                            });

                        }

                    });
                },

                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Error - ' + errorThrown);
                }
            });
            

            
        });

    </script>

}