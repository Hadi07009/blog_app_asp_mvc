@model BootstrapERP.Models.SiteContentDetails
@using System.Data;

@{
    ViewBag.Title = "User Permission";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <div class="page-header">
                <h4 style="display:inline-block"><span class="hapText"> @ViewBag.Title</span> <small> </small></h4>
                <ol class="breadcrumbLine" style="float:right;display:inline-block">
                    <li class="hapText">@Html.ActionLink("Home", "Index", "BlogPosts")</li>
                    <li class="hapText">@ViewBag.Title</li>
                </ol>
            </div>
        </div>
        <div class="clearfix"></div>
        <div class="col-sm-12" style="min-height:550px">
            @using (Html.BeginForm("Index", "UserRole"))
            {
                @Html.ValidationSummary(true)
                @Html.AntiForgeryToken()
            <div class="row">
                <div class="form-group col-lg-6">
                    <label for="input2" class="labelcss">User Email</label>
                    @Html.TextBoxFor(model => model.AuthorsName, new { style = "width:100%;", type = "email", @class = "form-control", id = "userCode", @required = true, pattern = "^[a-zA-Z0-9_\\.-]+@([a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,6}$" })
                    @Html.ValidationMessageFor(model => model.AuthorsName, "", new { @class = "text-danger" })
                </div>
                <div class="clearfix"></div>
                <div class="form-group col-lg-6">
                    <button id="checkUserRole" data-toggle="modal"  class="btn  btn-info"> Search </button>
                </div>
                <div class="clearfix"></div>
                @*<div class="form-group col-lg-6">
            <label for="input2">Role Type</label>
            @Html.DropDownList("BlogRoleType", null, new { type = "text", @class = "form-control" })
        </div>*@
                <div class="clearfix"></div>
                <div id="areaRoleTypeList" class="form-group col-lg-6" style="overflow-x: auto;overflow-y: auto;display:none">
                    <label for="input2" style="font:bold;" class="labelcss">Current Role type list :</label>
                </div>
                <div class="clearfix"></div>
                <div class="form-group col-lg-6" style="overflow-x: auto;overflow-y: auto;">
                    <div id="treeRoleType" class="checkboxes"></div>
                </div>
                <div class="clearfix"></div>
                @*<div class="col-lg-6 col-md-6">
                    <div id="areaRoleList" style="overflow-x: auto;overflow-y: auto;display:none">
                        <div id="tree" class="checkboxesStyle"></div>
                    </div>
                </div>*@
                <div class="col-lg-6 col-md-6"  >
            <div id="areaRoleList" style="overflow-x: auto;overflow-y: auto;display:none">
                <div class="panel panel-primary">
                    <div class="panel-heading">Available Roles : You may add more from this list</div>
                    <div class="panel-body">
                        <div id="tree" class="checkboxesStyle"></div>
                        <div class="clearfix">
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <div class="clearfix"></div>
                <div class="form-group col-lg-6" id="areaSaveButton" style="display:none">
                    <button id="saveUserRole" data-toggle="modal" class="btn btn-primary btn-anim"><i class="fa fa-pencil"></i><span class="btn-text">Save</span></button>
                    <button id="calcelUserRole" data-toggle="modal" class="btn btn-danger"> Cancel</button>
                </div>
                <div class="clearfix"></div>
            </div>
                <div class="clearfix"></div>
                }
            </div>

    </div>
    
</div>

<link href="~/css/StyleSheetForTable.css" rel="stylesheet" />
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
    <script src="~/Scripts/Gijgo/gijgo.js"></script>
    <script src="~/Scripts/conditional-validation.js"></script>
    <link href="~/http://code.gijgo.com/1.3.0/css/gijgo.css" rel="stylesheet" type="text/css" />


    @*<script src="/js/jquery.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery-1.7.1.js" type="text/javascript"></script>
    <script src="../../Scripts/jquery-1.7.1.min.js" type="text/javascript"></script>*@



    <script type="text/javascript">
        $(document).ready(function () {
            $('#checkUserRole').click(function (e) 
            {
                try {
                    e.preventDefault();

                    var emailCheck = "";
                    var userCodeTemp = $('#userCode').val();
                    if (userCodeTemp == "") {
                        throw "Please type user email ";
                        }
                    else {
                        $.ajax({
                            type: "POST",
                            data: { Message: $("#userCode").val() },
                            url: '@Url.Action("CheckUserEmail", "UserRole")',
                            async: false,
                            dataType: 'json',
                            success: function (records) {
                                emailCheck = records;
                            },
                        });
                    }

                    if (emailCheck == 0) {
                        throw "This email do not exist. ";
                    }

                    var x = document.getElementById("areaSaveButton");
                    x.style.display = "block";
                    var xx = document.getElementById("areaRoleList");
                    xx.style.display = "block";
                    var y = document.getElementById("areaRoleTypeList");
                    y.style.display = "block";
                    var Usertree = "";
                    var treeRoleType = "";
                    var treeRoleType = $('#treeRoleType').tree();
                    treeRoleType.destroy();
                    var tree = "";
                    var tree = $('#tree').tree();
                    tree.destroy();


                $.ajax({
                type: "POST",
                data: { Message: $("#userCode").val() },
                url: '@Url.Action("GetAllRoleType", "UserRole")',
                dataType: 'json',
                success: function (records, textStatus, jqXHR, state) {
                    treeRoleType = $('#treeRoleType').tree({
                        primaryKey: 'Id',
                        checkedField: 'nodeCheckValue',
                        dataSource: records,
                        checkboxes: true,
                        icons: {
                            expand: '<img src="http://27.147.194.136:82/Images/Expand.png" class="material-icons" />',
                            collapse: '<img class="material-icons" src="http://27.147.194.136:82/Images/Collapse.png" />'
                        },
                        });
                    },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert(errorThrown);
                }
                });



                
            $.ajax({
                type: "POST",
                data: { Message: $("#userCode").val() },
                url: '@Url.Action("GetAllRoles", "UserRole")',
                dataType: 'json',
                success: function (records, textStatus, jqXHR, state) {
                    tree = $('#tree').tree({
                        primaryKey: 'Id',
                        checkedField: 'nodeCheckValue',
                        dataSource: records,
                        checkboxes: true,
                        icons: {
                            expand: '<img src="http://27.147.194.136:82/Images/Expand.png" class="material-icons" />',
                            collapse: '<img class="material-icons" src="http://27.147.194.136:82/Images/Collapse.png" />'
                        },
                    });



                    $('#calcelUserRole').click(function (e) {
                        e.preventDefault();
                        window.location.reload();
                    });

                    $('#saveUserRole').click(function (e) {
                        e.preventDefault();
                        var blogRoleType = treeRoleType.getCheckedNodes();
                        var userCodeTemp = $('#userCode').val();
                        var result = tree.getCheckedNodes();
                        if (userCodeTemp != "") {
                                if (blogRoleType != "") {
                                    if (result != "") {
                                        blogRoleType = userCodeTemp + "," + blogRoleType + "," + "flagType" + "," + result;
                                        $.ajax({
                                        type: "POST",
                                        url: '@Url.Action("Index", "UserRole")',
                                        data: { values: blogRoleType.toString() },
                                        dataType: "json",
                                        success: function (data) {
                                            alert("Role Created successfully ");
                                            window.location.reload();
                                        },
                                    });
                                }
                                else {
                                    alert("Please select role from List ");
                                    }
                                }
                                else {
                                    alert("Please select role type from List ");
                                    }
                            }
                            else {
                                alert("Please type user email ");
                            }
                        
                    });

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Error - ' + errorThrown);
                }
                });

                } catch (e) {
                    alert(e);

                }

            });



            @*$("#BlogRoleType").change(function () {
                var x = document.getElementById("areaSaveButton");
                x.style.display = "block";
                var Usertree = "";
                var tree = "";
                var treet = $('#tree').tree();
                treet.destroy();
                
            $.ajax({
                type: "POST",
                data: { Message: $("#BlogRoleType").val() },
                url: '@Url.Action("GetHierarchy", "UserRole")',
                dataType: 'json',
                success: function (records, textStatus, jqXHR, state) {
                    tree = $('#tree').tree({
                        primaryKey: 'Id',
                        dataSource: records,
                        checkboxes: true,
                        icons: {
                            expand: '<img src="http://27.147.194.136:82/Images/Expand.png" class="material-icons" />',
                            collapse: '<img class="material-icons" src="http://27.147.194.136:82/Images/Collapse.png" />'
                        },
                    });

                    $('#saveUserRole').click(function (e) {
                e.preventDefault();

                var message, x;
                message = document.getElementById("p01");
                message.innerHTML = "";

                var blogRoleType = $('#BlogRoleType').val();
                var userCodeTemp = $('#userCode').val();

                var result = tree.getCheckedNodes();
                try {
                    if (result != "") {
                            blogRoleType = blogRoleType + "," + userCodeTemp + "," + result;
                            $.ajax({
                                type: "POST",
                                url: '@Url.Action("Index", "UserRole")',
                                data: { values: blogRoleType.toString() },
                                dataType: "json",
                                success: function (data) {
                                    alert("Role Created successfully ");
                                    window.location.reload();
                                },
                            });
                        }
                    else {
                        
                        alert("Please select role from List ");
                        window.location.reload();
                            
                    }
                }
                catch (err) {
                    message.innerHTML = err;
                }
            });

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    alert('Error - ' + errorThrown);
                }
                });
            })*@

            

        });

         
    </script>
    <style>

        .checkboxesStyle {
            float: none;
            display: block;
            line-height: 23px;
            font-family: Helvetica;
            color: red !important;
            font-weight: 300;
        }
            .checkboxesStyle input {
                margin: 0px 0px 0px 0px;
            }
            .checkboxesStyle label {
                margin: 7px 5px 0px 0px;
            }

    </style>

}



